<tal:block tal:define="proxy nocall:options/proxy;
                       items proxy/getBookContents;
                       book python:here.getContent();
                       nb_items python:int(getattr(book,'nb_items_per_summary_page',20));
                       page_batch_start python:int(path('request/start | nothing') or 0);
                       page_batch python:modules['ZTUtils'].Batch(items,
                                                                  size=nb_items,
                                                                  start=page_batch_start);
                       previous_page python:page_batch.previous;
                       next_page python:page_batch.next;
                       nb_items_in_current_batch python:len(page_batch);
                       mq nocall:modules/ZTUtils/make_query">

<div class="bookSummary"
     tal:define="prev_or_next python:previous_page or next_page">
  <h3 i18n:translate="">cpsdoc_title_toc</h3>

  <ul>
    <div tal:repeat="item page_batch">
      <div tal:define="level python:item[0];
                   proxy python:item[2];
                   margin python:level*15">
        <li class=summaryEntries tal:attributes="style string:margin-left:${level}em"><a
          tal:content="proxy/Title" tal:attributes="href proxy/absolute_url"/></li>
      </div>
    </div>
  </ul>

  <div tal:condition="prev_or_next"
       class="bookSummaryNav">
    <a href="." tal:condition="previous_page"
       tal:attributes="href python:'%s?%s'%(request['URL'],
                                            mq(request.form,
                                                   start=0))">«</a>
    <a tal:condition="previous_page"
       tal:attributes="href python:'%s?%s'%(request['URL'],
                                            mq(request.form,
                                               start=previous_page.first))"
       i18n:translate="">batch_previous</a>
    <a tal:condition="next_page"
       tal:attributes="href python:'%s?%s'%(request['URL'],
                                          mq(request.form, start=next_page.first))"
       i18n:translate="">batch_next</a>
    <a href="." tal:condition="next_page"
       tal:attributes="href python:'%s?%s'%(request['URL'],
                                            mq(request.form,
                                               start=len(items) - (len(items) % nb_items)))">»</a>
  </div>
</div>

</tal:block>
