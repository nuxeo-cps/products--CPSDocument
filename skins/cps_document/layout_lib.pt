<!-- macro library for layouts -->
<!-- $Id$ -->

<!-- ============================================================ -->
<metal:block define-macro="default_view"
  tal:define="layout options/layout;
              ds options/datastructure;
              ">
<table width="100%" cellpadding="2" cellspacing="2" border="0">
  <tr tal:repeat="row layout/rows">
    <td tal:repeat="cell row" tal:attributes="colspan cell/ncols">
      <tal:block define="widget cell/widget;
        wrender python:widget.render('view', ds)"
        condition="python: not widget.hidden_view and
                           (not widget.hidden_empty or wrender.strip())">
      <div tal:attributes="class widget/css_class|nothing">
        <tal:block condition="widget/label">
          <span class="dlabel" i18n:translate="" tal:condition="widget/is_i18n"
            tal:content="widget/label">label</span>
          <span class="dlabel" tal:condition="not:widget/is_i18n"
            tal:content="widget/label">label</span>
        </tal:block>
        <tal:block replace="structure wrender" />
      </div>
      </tal:block>
    </td>
  </tr>
</table>
</metal:block>

<!-- this layout doesn't take care of cell layout =============== -->
<metal:block define-macro="div_view"
  tal:define="layout options/layout;
              ds options/datastructure;
              ">
  <tal:block repeat="row layout/rows">
    <tal:block repeat="cell row">
      <tal:block define="widget cell/widget;
        wrender python:widget.render('view', ds)"
        condition="python: not widget.hidden_view and
                           (not widget.hidden_empty or wrender.strip())">
      <div tal:attributes="class widget/css_class|nothing">
        <tal:block condition="widget/label">
          <span class="dlabel" i18n:translate="" tal:condition="widget/is_i18n"
            tal:content="widget/label">label</span>
          <span tal:condition="not:widget/is_i18n"
            tal:content="widget/label">label</span>
        </tal:block>
        <tal:block replace="structure wrender" />
      </div>
      </tal:block>
    </tal:block>
  </tal:block>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="default_edit"
  tal:define="layout options/layout;
              ds options/datastructure;
              ok options/ok|python:1;">
<div class="message" tal:condition="not:ok">
  <span i18n:translate="cpsdoc_form_error">Form error.</span>
</div>
<div class="group">
<form action="." method="POST" name="form" enctype="multipart/form-data"
  tal:attributes="action string:cpsdocument_edit_form">
<table width="100%" cellpadding="2" cellspacing="2" border="0">
  <tr tal:repeat="row layout/rows" valign="top">
    <td tal:repeat="cell row"
      tal:attributes="colspan cell/ncols">
      <tal:block define="widget cell/widget;
                         wid widget/getWidgetId;
                         err python:ds.getError(wid);
                         is_required widget/is_required|nothing"
        condition="not:widget/hidden_edit">
        <div tal:attributes="class python:test(err, 'row error', 'row')">
          <div class="label" tal:condition="widget/label_edit"
            tal:attributes="class python:test(is_required, 'label required',
                                              'label')">
            <span i18n:translate="" tal:condition="widget/is_i18n"
              tal:content="widget/label_edit">label</span>
            <span tal:condition="not:widget/is_i18n"
              tal:content="widget/label_edit">label</span>
          </div>
          <div class="field">
            <div tal:replace="structure python:widget.render('edit', ds)"/>
          </div>
          <tal:block condition="err">
            <br><em style="color: red"
                  i18n:translate="" tal:content="err">err</em>
          </tal:block>
        </div>
      </tal:block>
    </td>
  </tr>
</table>
<metal:block define-slot="additional_content" />
<input type="submit" class="standalone" name="cpsdocument_edit_button"
  value="button_change" i18n:attributes="value">
</form>
</div>
</metal:block>
